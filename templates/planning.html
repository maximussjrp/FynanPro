<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planejamento Financeiro - FynanPro</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 2rem 0;
            color: white;
        }
        
        .card-custom {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
        }
        
        .card-custom:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-weight: 600;
        }
        
        .btn-custom:hover {
            background: linear-gradient(45deg, #5a67d8, #6b46c1);
            color: white;
        }
        
        .planning-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .scenario-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content p-4">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h2 mb-1">
                        <i class="fas fa-chess me-2"></i>
                        Planejamento Financeiro
                    </h1>
                    <p class="text-light opacity-75 mb-0">Estratégias e projeções para seu futuro financeiro</p>
                </div>
                <div>
                    <a href="/" class="btn btn-outline-light">
                        <i class="fas fa-home"></i> Voltar ao Dashboard
                    </a>
                </div>
            </div>

            <!-- Cards de Planejamento -->
            <div class="row g-4 mb-4">
                <!-- Simulador de Cenários -->
                <div class="col-lg-6">
                    <div class="card-custom h-100">
                        <div class="card-body p-4">
                            <div class="d-flex align-items-center mb-3">
                                <div class="planning-icon me-3">
                                    <i class="fas fa-chart-line fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h5 class="mb-1">Simulador de Cenários</h5>
                                    <small class="text-light opacity-75">Projete diferentes situações financeiras</small>
                                </div>
                            </div>
                            <p class="text-light opacity-75 mb-4">
                                Crie e compare diferentes cenários financeiros. 
                                Veja o impacto de mudanças na renda, gastos ou investimentos.
                            </p>
                            <button class="btn btn-custom w-100" data-bs-toggle="modal" data-bs-target="#scenarioModal">
                                <i class="fas fa-calculator me-2"></i>Simular Cenário
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Planejamento de Aposentadoria -->
                <div class="col-lg-6">
                    <div class="card-custom h-100">
                        <div class="card-body p-4">
                            <div class="d-flex align-items-center mb-3">
                                <div class="planning-icon me-3">
                                    <i class="fas fa-umbrella fa-2x text-success"></i>
                                </div>
                                <div>
                                    <h5 class="mb-1">Aposentadoria</h5>
                                    <small class="text-light opacity-75">Planeje sua independência financeira</small>
                                </div>
                            </div>
                            <p class="text-light opacity-75 mb-4">
                                Calcule quanto precisa economizar para se aposentar. 
                                Defina metas de longo prazo e acompanhe seu progresso.
                            </p>
                            <button class="btn btn-custom w-100" data-bs-toggle="modal" data-bs-target="#retirementModal">
                                <i class="fas fa-piggy-bank me-2"></i>Planejar Aposentadoria
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projeções Financeiras -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card-custom">
                        <div class="card-body">
                            <h5 class="mb-4">
                                <i class="fas fa-crystal-ball me-2"></i>
                                Projeções dos Próximos 12 Meses
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-4 text-center">
                                    <h3 class="text-info">R$ {{ "%.2f"|format(projected_income|default(0)) }}</h3>
                                    <small class="text-light opacity-75">Receita Projetada</small>
                                </div>
                                <div class="col-md-4 text-center">
                                    <h3 class="text-warning">R$ {{ "%.2f"|format(projected_expenses|default(0)) }}</h3>
                                    <small class="text-light opacity-75">Gastos Projetados</small>
                                </div>
                                <div class="col-md-4 text-center">
                                    <h3 class="{% if projected_savings >= 0 %}text-success{% else %}text-danger{% endif %}">
                                        R$ {{ "%.2f"|format(projected_savings|default(0)) }}
                                    </h3>
                                    <small class="text-light opacity-75">Economia Esperada</small>
                                </div>
                            </div>
                            
                            <hr class="border-light border-opacity-25 my-4">
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">
                                        <i class="fas fa-trend-up me-2"></i>
                                        Receitas Recorrentes
                                    </h6>
                                    {% if recurring_income %}
                                        {% for income in recurring_income %}
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>{{ income.description }}</span>
                                            <span class="text-success">+R$ {{ "%.2f"|format(income.amount) }}</span>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                    <small class="text-light opacity-50">Nenhuma receita recorrente cadastrada</small>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">
                                        <i class="fas fa-trend-down me-2"></i>
                                        Despesas Recorrentes
                                    </h6>
                                    {% if recurring_expenses %}
                                        {% for expense in recurring_expenses %}
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>{{ expense.description }}</span>
                                            <span class="text-danger">-R$ {{ "%.2f"|format(expense.amount) }}</span>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                    <small class="text-light opacity-50">Nenhuma despesa recorrente cadastrada</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recomendações Inteligentes -->
            <div class="row">
                <div class="col-12">
                    <div class="card-custom">
                        <div class="card-body">
                            <h5 class="mb-4">
                                <i class="fas fa-lightbulb me-2"></i>
                                Recomendações Inteligentes
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="scenario-card">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-cut text-warning me-2"></i>
                                            <h6 class="mb-0">Corte de Gastos</h6>
                                        </div>
                                        <small class="text-light opacity-75">
                                            Reduza 10% dos gastos variáveis e economize 
                                            R$ {{ "%.2f"|format((projected_expenses * 0.1)|default(0)) }} por mês
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="scenario-card">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-chart-line text-success me-2"></i>
                                            <h6 class="mb-0">Investimento</h6>
                                        </div>
                                        <small class="text-light opacity-75">
                                            Invista 20% da sua renda e tenha potencial de 
                                            R$ {{ "%.2f"|format((projected_income * 0.2 * 1.12)|default(0)) }} em um ano
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="scenario-card">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-shield-alt text-info me-2"></i>
                                            <h6 class="mb-0">Reserva de Emergência</h6>
                                        </div>
                                        <small class="text-light opacity-75">
                                            Você deveria ter R$ {{ "%.2f"|format((projected_expenses * 6)|default(0)) }} 
                                            de reserva (6 meses de gastos)
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Simulador de Cenário -->
            <div class="modal fade" id="scenarioModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content bg-dark">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-calculator"></i> Simulador de Cenário
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="scenarioForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="mb-3">Receitas Mensais</h6>
                                        <div class="mb-3">
                                            <label class="form-label">Salário</label>
                                            <input type="number" class="form-control bg-dark text-white" 
                                                   id="salary" step="0.01" value="0">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Renda Extra</label>
                                            <input type="number" class="form-control bg-dark text-white" 
                                                   id="extraIncome" step="0.01" value="0">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="mb-3">Gastos Mensais</h6>
                                        <div class="mb-3">
                                            <label class="form-label">Gastos Fixos</label>
                                            <input type="number" class="form-control bg-dark text-white" 
                                                   id="fixedExpenses" step="0.01" value="0">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Gastos Variáveis</label>
                                            <input type="number" class="form-control bg-dark text-white" 
                                                   id="variableExpenses" step="0.01" value="0">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Período de Simulação (meses)</label>
                                    <input type="number" class="form-control bg-dark text-white" 
                                           id="simulationPeriod" min="1" max="60" value="12">
                                </div>
                            </form>
                            
                            <div id="scenarioResults" class="mt-4" style="display: none;">
                                <h6>Resultados da Simulação:</h6>
                                <div class="row">
                                    <div class="col-md-4 text-center">
                                        <h5 class="text-success" id="totalIncome">R$ 0,00</h5>
                                        <small>Receita Total</small>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <h5 class="text-danger" id="totalExpenses">R$ 0,00</h5>
                                        <small>Gastos Totais</small>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <h5 id="netResult">R$ 0,00</h5>
                                        <small>Resultado Líquido</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                            <button type="button" class="btn btn-custom" onclick="calculateScenario()">
                                <i class="fas fa-calculator"></i> Calcular
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Aposentadoria -->
            <div class="modal fade" id="retirementModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content bg-dark">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-umbrella"></i> Planejamento de Aposentadoria
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="retirementForm">
                                <div class="mb-3">
                                    <label class="form-label">Idade Atual</label>
                                    <input type="number" class="form-control bg-dark text-white" 
                                           id="currentAge" min="18" max="80" value="30">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Idade Desejada para Aposentadoria</label>
                                    <input type="number" class="form-control bg-dark text-white" 
                                           id="retirementAge" min="50" max="80" value="65">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Renda Mensal Desejada (aposentadoria)</label>
                                    <input type="number" class="form-control bg-dark text-white" 
                                           id="desiredIncome" step="0.01" value="5000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Taxa de Rendimento Anual (%)</label>
                                    <input type="number" class="form-control bg-dark text-white" 
                                           id="annualReturn" step="0.1" value="8" max="20">
                                </div>
                            </form>
                            
                            <div id="retirementResults" class="mt-4" style="display: none;">
                                <h6>Resultados do Planejamento:</h6>
                                <div class="text-center">
                                    <h4 class="text-success" id="monthlyInvestment">R$ 0,00</h4>
                                    <small>Investimento mensal necessário</small>
                                </div>
                                <hr>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <div id="yearsToRetire">0</div>
                                        <small>Anos até aposentadoria</small>
                                    </div>
                                    <div class="col-6">
                                        <div id="totalAccumulated">R$ 0,00</div>
                                        <small>Total acumulado</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                            <button type="button" class="btn btn-custom" onclick="calculateRetirement()">
                                <i class="fas fa-calculator"></i> Calcular
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function calculateScenario() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const extraIncome = parseFloat(document.getElementById('extraIncome').value) || 0;
            const fixedExpenses = parseFloat(document.getElementById('fixedExpenses').value) || 0;
            const variableExpenses = parseFloat(document.getElementById('variableExpenses').value) || 0;
            const period = parseInt(document.getElementById('simulationPeriod').value) || 12;
            
            const monthlyIncome = salary + extraIncome;
            const monthlyExpenses = fixedExpenses + variableExpenses;
            const monthlyNet = monthlyIncome - monthlyExpenses;
            
            const totalIncome = monthlyIncome * period;
            const totalExpenses = monthlyExpenses * period;
            const netResult = totalIncome - totalExpenses;
            
            document.getElementById('totalIncome').textContent = 'R$ ' + totalIncome.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            document.getElementById('totalExpenses').textContent = 'R$ ' + totalExpenses.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            document.getElementById('netResult').textContent = 'R$ ' + netResult.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            document.getElementById('netResult').className = netResult >= 0 ? 'text-success' : 'text-danger';
            
            document.getElementById('scenarioResults').style.display = 'block';
        }
        
        function calculateRetirement() {
            const currentAge = parseInt(document.getElementById('currentAge').value) || 30;
            const retirementAge = parseInt(document.getElementById('retirementAge').value) || 65;
            const desiredIncome = parseFloat(document.getElementById('desiredIncome').value) || 5000;
            const annualReturn = parseFloat(document.getElementById('annualReturn').value) / 100 || 0.08;
            
            const yearsToRetire = retirementAge - currentAge;
            const monthlyReturn = annualReturn / 12;
            
            // Cálculo simplificado para renda vitalícia
            const totalNeeded = desiredIncome / (monthlyReturn);
            const monthlyInvestment = totalNeeded * monthlyReturn / ((Math.pow(1 + monthlyReturn, yearsToRetire * 12) - 1));
            
            document.getElementById('yearsToRetire').textContent = yearsToRetire;
            document.getElementById('monthlyInvestment').textContent = 'R$ ' + monthlyInvestment.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            document.getElementById('totalAccumulated').textContent = 'R$ ' + totalNeeded.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            
            document.getElementById('retirementResults').style.display = 'block';
        }
    </script>
</body>
</html>
